#Monitor 

### cwait and csignal

çœ‹æ•™ç§‘ä¹¦Producer/Consumerï¼Œä¸€å¤„ç–‘æƒ‘ï¼Œå†è¯»ä¹‹ï¼Œæ˜¯å› ä¸ºmonitoré‡Œé¢ç”¨çš„æ˜¯conditional variableï¼Œä¹Ÿå°±æ˜¯booleanå€¼ï¼Œcwait()æ˜¯suspend/blockï¼Œcsignal()æ˜¯resume execution.


```
void append(char x)
{
	if (count == N) cwait(notfull);    /* buffer is full; avoid overflow */
	...
}
```

æ‰€ä»¥æ­¤å¤„çš„ç†è§£åº”å½“æ˜¯ï¼Œcount == Nï¼Œ notfullä¸ºfalseäº†ï¼Œè¿™ä¸ªæ—¶å€™å°±å°†è°ƒç”¨appendè¿™ä¸ªçº¿ç¨‹blockedæ‰ï¼Œç›´åˆ°count < N ,notfullä¸ºtrueï¼Œæ‰å†åº¦é‡Šæ”¾ï¼Œæ‰§è¡Œä¸‹æ–¹çš„è¯­å¥ï¼Œæ˜¯å’Œcompare and swapæœ‰ç±»ä¼¼çš„æ„Ÿè§‰å˜›....


###Monitors in Java


- Object.wait() call the calling thread to wait(block) for notify() to be called on the same object.

- Object.notify() releases a thread that is blocked by a wait() on the same object

- Object.notifyAll() releases all threads blocked by a wait on the same object.

è¿˜æ˜¯çœ‹ä¸€ä¸ªğŸŒ°å‡å°‘æŠ½è±¡ï¼Œ [File][id]

[id]:https://github.com/KrisYu/OSConceptsExamples/blob/master/CriticalSectionMonitor.java

å†™èµ·æ¥ä¹Ÿæ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œå¯ä»¥æ³¨æ„çš„ç‚¹ï¼š

- 		// Needed to start / unblock the first waiting thread. 
		synchronized(monitor) {
			monitor.notify();
		}
		å¦åˆ™ç¨‹åºä¸ä¼šå¼€å§‹è¿è¡Œ



-			
			synchronized(monitor) {  // Start Critical Section
				monitor.wait();
			}
			
			....//CS code
			
			synchronized(monitor) { // End Critical Section
				monitor.notify();
			}
			
-			Thread.yield();

thread éœ€è¦yieldè®©ä½


å¦å¤–ï¼Œå…¶å®synchronizeå’Œmonitoræˆ‘è¡¨ç¤ºè¿·èŒ«...


###å¯ä»¥ç©çš„ç‚¹

æ”¹æ­¤å¤„ä»£ç ï¼š
æ”¹æˆnotifyAll

```
// Needed to start / unblock the first waiting thread. 
synchronized(monitor) {
	monitor.notifyAll();
}
```

ç»“æœä¼šå‡ºé”™ï¼Œå› ä¸ºnotifyAllæ˜¯release all threadsï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š

é”™çš„ç‚¹æ˜¯åœ¨äºä¸€å¼€å§‹å°±æŠŠæ‰€æœ‰çš„threadsæ”¾äº†å‡ºæ¥

```
...
 wsN AshoIsn
 
e
Moo loe
...

```


å½“ç„¶æ”¹ä»£ç æŠŠè¿™é‡Œæ”¹æˆnotifyAll()ä¹Ÿä¼šå‡ºç±»ä¼¼çš„é”™è¯¯...


```
synchronized(monitor) { // End Critical Section
	monitor.notify();
}
```


